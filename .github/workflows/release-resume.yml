name: Release Resume

on:
  push:
    branches:
      - '*'  # Trigger on push to any branch

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Required for creating releases

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Nix
        uses: DeterminateSystems/nix-installer-action@main

      - name: Build and Release Resume
        run: |
          nix develop --command bash -c '
            # Generate the resume PDF
            dhall text --file dhall/render/resume.dhall > resume.tex
            cp dhall/render/developercv.cls .
            pdflatex -interaction=nonstopmode resume.tex || true
            pdflatex -interaction=nonstopmode resume.tex || true
          '
          # Create the release
          gh release create "resume-$(date +%Y%m%d)" \
            --generate-notes \
            resume.pdf
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 